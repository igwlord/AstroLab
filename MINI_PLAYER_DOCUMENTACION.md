# üéµ MINI PLAYER FLOTANTE - Frecuencias Zodiacales

**Fecha:** 9 de Octubre, 2025  
**Feature:** Mini player flotante con est√©tica astrol√≥gica  
**Estado:** ‚úÖ COMPLETADO

---

## üìã DESCRIPCI√ìN

Mini player flotante que permite reproducir frecuencias zodiacales en toda la aplicaci√≥n sin interrupciones. El audio contin√∫a sonando aunque cambies de p√°gina.

---

## ‚ú® CARACTER√çSTICAS

### üéØ Funcionalidades

1. **Reproducci√≥n continua:** El audio no se interrumpe al cambiar de p√°gina
2. **Controles intuitivos:**
   - ‚ñ∂Ô∏è Play/Pause
   - ‚èÆÔ∏è Anterior
   - ‚è≠Ô∏è Siguiente
3. **Informaci√≥n visual:**
   - S√≠mbolo del signo zodiacal
   - Nombre del signo
   - Frecuencia en Hz
   - Animaci√≥n de ondas cuando est√° reproduciendo

### üì± Dise√±o Adaptativo

#### Desktop (md+)
- **Posici√≥n:** Flotante en esquina inferior derecha
- **Tama√±o:** 280px (normal) / 320px (expandido)
- **Features:**
  - Bot√≥n expandir/colapsar
  - Info adicional: Chakra y Elemento
  - Decoraci√≥n con estrellas animadas
  - Pulso de luz cuando est√° reproduciendo

#### Mobile (< md)
- **Posici√≥n:** Integrado en men√∫ hamburguesa
- **Ubicaci√≥n:** Entre opciones de navegaci√≥n y Theme Toggle
- **Caracter√≠sticas:**
  - Dise√±o compacto
  - Controles t√°ctiles optimizados
  - No tapa opciones del men√∫
  - Se oculta cuando se cierra el men√∫

---

## üèóÔ∏è ARQUITECTURA

### Context Global: AudioPlayerContext

**Archivo:** `src/context/AudioPlayerContext.tsx`

```typescript
interface AudioPlayerContextType {
  currentFrequency: ZodiacFrequency | null;
  isPlaying: boolean;
  play: (frequency: ZodiacFrequency) => void;
  pause: () => void;
  toggle: () => void;
  next: () => void;
  previous: () => void;
}
```

**Funcionalidades:**
- ‚úÖ Estado global compartido
- ‚úÖ Singleton Audio element (HTMLAudioElement)
- ‚úÖ Loop autom√°tico
- ‚úÖ Navegaci√≥n entre frecuencias (next/previous)
- ‚úÖ Event listeners para sincronizaci√≥n

---

### Componente: FloatingMiniPlayer

**Archivo:** `src/components/FloatingMiniPlayer.tsx`

**Props:**
```typescript
interface FloatingMiniPlayerProps {
  isMobile?: boolean;
}
```

**Comportamiento:**
- `isMobile={false}` ‚Üí Versi√≥n desktop flotante
- `isMobile={true}` ‚Üí Versi√≥n mobile integrada

**Renderizado condicional:**
```typescript
if (!currentFrequency) return null; // No mostrar si no hay audio
if (isMobile) return <MobileVersion />;
return <DesktopVersion />;
```

---

### Integraci√≥n en SolarPlayer

**Archivo:** `src/components/SolarPlayer.tsx`

**Cambios realizados:**
- ‚ùå Eliminado: Estado local de audio (audioRef, isPlaying)
- ‚úÖ Agregado: Hook useAudioPlayer() del context
- ‚úÖ Sincronizaci√≥n: isThisPlaying detecta si este player est√° activo
- ‚úÖ Auto-play: Se mantiene funcional con el context

**C√≥digo clave:**
```typescript
const { currentFrequency, isPlaying, play, toggle } = useAudioPlayer();

const handleToggle = () => {
  if (!selectedFrequency) return;
  
  if (!currentFrequency || currentFrequency.id !== selectedFrequency.id) {
    play(selectedFrequency); // Cambiar frecuencia
  } else {
    toggle(); // Play/Pause misma frecuencia
  }
};

const isThisPlaying = isPlaying && currentFrequency?.id === selectedFrequency?.id;
```

---

### Integraci√≥n en Navbar

**Archivo:** `src/components/Navbar.tsx`

**Ubicaci√≥n en el men√∫ m√≥vil:**
```tsx
{/* Opciones de navegaci√≥n */}
{navItems.map((item) => <Link ... />)}

{/* üéµ Mini Player Mobile - AQU√ç SE INTEGRA */}
<FloatingMiniPlayer isMobile={true} />

{/* Theme Toggle */}
<div className="border-t ...">
  <ThemeToggle />
</div>
```

**Ventajas:**
- ‚úÖ No tapa opciones de navegaci√≥n
- ‚úÖ Separado visualmente con border-top
- ‚úÖ Accesible desde el men√∫ hamburguesa
- ‚úÖ Scroll interno si el men√∫ es muy largo

---

### Integraci√≥n en App

**Archivo:** `src/App.tsx`

**Provider y Player:**
```tsx
<AudioPlayerProvider>
  <Router>
    <ErrorBoundary>
      <AppRoutes />
      {/* Solo desktop - mobile est√° en Navbar */}
      <FloatingMiniPlayer isMobile={false} />
    </ErrorBoundary>
  </Router>
</AudioPlayerProvider>
```

---

## üé® EST√âTICA ASTROL√ìGICA

### Colores din√°micos
- **Fondo:** Gradiente purple-900 ‚Üí indigo-900 ‚Üí purple-800
- **Bot√≥n principal:** Color del signo actual (frequency.color.hex)
- **Decoraci√≥n:** Estrellas (‚ú¶ ‚úß) con opacidad 20%

### Animaciones

#### Animaci√≥n de ondas (reproduce)
```css
@keyframes wave {
  0%, 100% { transform: scaleY(0.5); }
  50% { transform: scaleY(1); }
}
```

**Uso:** 5 barras con delay progresivo (0s, 0.1s, 0.2s, 0.3s, 0.4s)

#### Pulso de luz (bot√≥n play)
```tsx
{isPlaying && (
  <>
    <div className="animate-ping border-white/30" />
    <div style={{ boxShadow: `0 0 30px ${color}` }} />
  </>
)}
```

#### Brillo de fondo
```tsx
<div 
  className="animate-pulse"
  style={{
    background: `radial-gradient(circle, ${color}66, transparent)`,
  }}
/>
```

---

## üìê DISE√ëO RESPONSIVE

### Breakpoints

| Tama√±o | Breakpoint | Comportamiento |
|--------|-----------|----------------|
| Mobile | `< 768px` | Integrado en men√∫ hamburguesa |
| Desktop | `‚â• 768px` | Flotante bottom-right |

### Dimensiones

**Desktop:**
- Normal: 280px √ó auto
- Expandido: 320px √ó auto
- Posici√≥n: `fixed bottom-6 right-6`
- Z-index: 50

**Mobile:**
- Ancho: 100% del men√∫
- Padding: 4 (1rem)
- Posici√≥n: Relativa dentro del men√∫
- Z-index: Heredado del men√∫ (50)

---

## üéØ CASOS DE USO

### 1. Usuario selecciona una frecuencia
```
FrequenciesPage ‚Üí ZodiacWheel ‚Üí SolarPlayer
   ‚Üì
SolarPlayer.handleToggle() ‚Üí context.play(frequency)
   ‚Üì
AudioPlayerContext actualiza currentFrequency e isPlaying
   ‚Üì
FloatingMiniPlayer se muestra (antes era null)
   ‚Üì
Usuario puede navegar a otra p√°gina y el audio contin√∫a
```

### 2. Usuario cambia de frecuencia desde el mini player
```
FloatingMiniPlayer.next() ‚Üí context.next()
   ‚Üì
Context busca siguiente frecuencia en ZODIAC_FREQUENCIES
   ‚Üì
Llama a context.play(nextFrequency)
   ‚Üì
SolarPlayer detecta cambio (isThisPlaying = false)
   ‚Üì
Nuevo SolarPlayer se activa (isThisPlaying = true)
```

### 3. Usuario pausa desde SolarPlayer
```
SolarPlayer.handleToggle() ‚Üí context.toggle()
   ‚Üì
Context ejecuta audioRef.pause()
   ‚Üì
isPlaying = false (event listener)
   ‚Üì
FloatingMiniPlayer actualiza bot√≥n a Play
   ‚Üì
SolarPlayer actualiza animaciones (rayos del sol)
```

---

## üß™ TESTING

### Checklist Desktop

- [ ] **Posici√≥n flotante:** Bottom-right, no interfiere con contenido
- [ ] **Bot√≥n expandir:** Muestra info de chakra y elemento
- [ ] **Animaciones:** Pulso y ondas cuando reproduce
- [ ] **Controles:**
  - [ ] Play/Pause funciona
  - [ ] Anterior cambia a frecuencia previa
  - [ ] Siguiente cambia a frecuencia posterior
- [ ] **Persistencia:** Audio contin√∫a al cambiar de p√°gina
- [ ] **Auto-hide:** Se oculta cuando no hay frecuencia

### Checklist Mobile

- [ ] **Integraci√≥n en men√∫:** Aparece en men√∫ hamburguesa
- [ ] **Posici√≥n:** Entre navegaci√≥n y Theme Toggle
- [ ] **No tapa opciones:** Scroll funciona si el men√∫ es largo
- [ ] **Controles t√°ctiles:** Botones f√°ciles de presionar
- [ ] **Animaci√≥n de ondas:** Visible cuando reproduce
- [ ] **Cierre de men√∫:** Player funciona despu√©s de cerrar men√∫
- [ ] **Persistencia:** Audio contin√∫a con men√∫ cerrado

### Testing de sincronizaci√≥n

1. **Abrir FrequenciesPage**
   - Seleccionar Aries (396 Hz)
   - Click en SolarPlayer ‚Üí Play
   - ‚úÖ Mini player aparece con Aries

2. **Navegar a Dashboard**
   - ‚úÖ Audio de Aries contin√∫a
   - ‚úÖ Mini player visible con Aries

3. **Click en Next (mini player)**
   - ‚úÖ Cambia a Tauro (528 Hz)
   - ‚úÖ Audio de Tauro suena

4. **Volver a FrequenciesPage**
   - Seleccionar G√©minis
   - Click en SolarPlayer ‚Üí Play
   - ‚úÖ Mini player cambia a G√©minis
   - ‚úÖ SolarPlayer de G√©minis muestra animaciones

5. **Click en Pause (mini player)**
   - ‚úÖ Audio se pausa
   - ‚úÖ SolarPlayer de G√©minis muestra bot√≥n Play
   - ‚úÖ Animaciones se detienen

---

## üêõ PROBLEMAS CONOCIDOS

### ‚ö†Ô∏è Fast Refresh Warning (AudioPlayerContext)
**Error:** `Fast refresh only works when a file only exports components`

**Causa:** El archivo exporta tanto el Provider (componente) como el hook useAudioPlayer (funci√≥n)

**Impacto:** ‚ö†Ô∏è BAJO - Solo afecta Hot Module Replacement en desarrollo

**Soluci√≥n futura (opcional):**
Separar en dos archivos:
- `AudioPlayerContext.tsx` ‚Üí Provider
- `useAudioPlayer.ts` ‚Üí Hook

**Estado:** üü° No urgente - funcionalidad no afectada

---

## üìä M√âTRICAS

### Bundle Impact
- **Context:** ~4 KB
- **FloatingMiniPlayer:** ~6 KB
- **SolarPlayer (modificado):** -2 KB (eliminado c√≥digo duplicado)
- **Total:** +8 KB (0.8% del bundle)

### Performance
- **Audio element:** Singleton (1 instancia global)
- **Re-renders:** Optimizado con React.memo (opcional)
- **Memory:** M√≠nimo (solo 1 audio elemento)

---

## üîÆ MEJORAS FUTURAS

### Fase 1 (Completada)
- ‚úÖ Context global para audio
- ‚úÖ Mini player desktop flotante
- ‚úÖ Mini player mobile integrado en men√∫
- ‚úÖ Sincronizaci√≥n con SolarPlayer

### Fase 2 (Opcional)
- [ ] Volume control (slider de volumen)
- [ ] Playlist feature (cola de reproducci√≥n)
- [ ] Repeat mode (repeat one, repeat all)
- [ ] Shuffle mode (aleatorio)
- [ ] Visualizador de frecuencia (canvas)

### Fase 3 (Avanzado)
- [ ] Keyboard shortcuts (Space, ‚Üê, ‚Üí)
- [ ] Media Session API (controles OS)
- [ ] Background sync (reproducci√≥n en background)
- [ ] Download offline (PWA cache)
- [ ] Share feature (compartir frecuencia)

---

## üìù C√ìDIGO DE EJEMPLO

### Usar el mini player en un nuevo componente

```tsx
import { useAudioPlayer } from '../context/AudioPlayerContext';
import { ZODIAC_FREQUENCIES } from '../data/zodiacFrequencies';

function MyComponent() {
  const { play, currentFrequency, isPlaying } = useAudioPlayer();

  const playRandomFrequency = () => {
    const random = ZODIAC_FREQUENCIES[
      Math.floor(Math.random() * ZODIAC_FREQUENCIES.length)
    ];
    play(random);
  };

  return (
    <div>
      <button onClick={playRandomFrequency}>
        Reproducir frecuencia aleatoria
      </button>
      
      {currentFrequency && (
        <p>
          {isPlaying ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è'} {currentFrequency.name} - {currentFrequency.frequency} Hz
        </p>
      )}
    </div>
  );
}
```

---

## üéâ RESULTADO FINAL

### Desktop
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                         ‚îÇ
‚îÇ         CONTENIDO DE LA P√ÅGINA          ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ                              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ                              ‚îÇ ‚ôà Aries ‚îÇ‚îÇ
‚îÇ                              ‚îÇ 396 Hz  ‚îÇ‚îÇ
‚îÇ                              ‚îÇ ‚èÆ ‚ñ∂Ô∏è ‚è≠  ‚îÇ‚îÇ
‚îÇ                              ‚îÇ ‚âã‚âã‚âã‚âã‚âã   ‚îÇ‚îÇ
‚îÇ                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Mobile (men√∫ abierto)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚â° ASTROLAB          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üè† Inicio           ‚îÇ
‚îÇ üéØ Carta Natal      ‚îÇ
‚îÇ üìö Glosario         ‚îÇ
‚îÇ üéµ Frecuencias      ‚îÇ
‚îÇ üíæ Mis Cartas       ‚îÇ
‚îÇ ‚öôÔ∏è Configuraci√≥n    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚Üê AQU√ç EST√Å
‚îÇ ‚îÇ ‚ôà Aries         ‚îÇ ‚îÇ   EL MINI
‚îÇ ‚îÇ 396 Hz Solfeggio‚îÇ ‚îÇ   PLAYER
‚îÇ ‚îÇ ‚èÆ ‚ñ∂Ô∏è ‚è≠          ‚îÇ ‚îÇ
‚îÇ ‚îÇ ‚âã‚âã‚âã‚âã‚âã           ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ üåô Theme Toggle     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

**Desarrollado con ‚ù§Ô∏è por el equipo AstroLab**  
**Versi√≥n:** 1.0.0  
**√öltima actualizaci√≥n:** 9 de Octubre, 2025
