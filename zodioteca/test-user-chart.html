<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üß™ Test: Tu Carta Natal - 16 Oct 1988</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #fff;
    }
    .container { max-width: 1000px; margin: 0 auto; }
    .header {
      text-align: center;
      margin-bottom: 30px;
      padding: 30px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
    }
    .card {
      background: rgba(255, 255, 255, 0.95);
      color: #333;
      padding: 30px;
      border-radius: 15px;
      margin-bottom: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    }
    .loading {
      text-align: center;
      padding: 50px;
      font-size: 1.5em;
    }
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 4px solid white;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .result-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    .result-table th {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px;
      text-align: left;
    }
    .result-table td {
      padding: 10px 12px;
      border-bottom: 1px solid #eee;
    }
    .result-table tr:hover {
      background: #f8f9ff;
    }
    .status-ok { color: #10b981; font-weight: bold; font-size: 1.5em; }
    .status-error { color: #ef4444; font-weight: bold; font-size: 1.5em; }
    .comparison {
      background: #f8f9ff;
      padding: 15px;
      border-radius: 10px;
      margin: 10px 0;
      border-left: 4px solid #667eea;
    }
    .comparison h4 {
      color: #667eea;
      margin-bottom: 10px;
    }
    .diff-good { color: #10b981; font-weight: bold; }
    .diff-warning { color: #f59e0b; font-weight: bold; }
    .diff-bad { color: #ef4444; font-weight: bold; }
    pre {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 10px;
      overflow-x: auto;
      font-size: 0.9em;
    }
    .symbol { font-size: 1.5em; margin-right: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üß™ Test de Validaci√≥n</h1>
      <h2>Tu Carta Natal - 16 Octubre 1988</h2>
      <p>Buenos Aires, Argentina</p>
    </div>
    
    <div class="card">
      <h2>üìã Datos de Nacimiento</h2>
      <table class="result-table">
        <tr>
          <th>Fecha</th>
          <td>16 de octubre de 1988</td>
        </tr>
        <tr>
          <th>Hora Local</th>
          <td>17:50 (-03:00)</td>
        </tr>
        <tr>
          <th>Hora UTC</th>
          <td>20:50</td>
        </tr>
        <tr>
          <th>Lugar</th>
          <td>Buenos Aires, Argentina</td>
        </tr>
        <tr>
          <th>Coordenadas</th>
          <td>34¬∞36'S, 58¬∞27'W</td>
        </tr>
      </table>
    </div>
    
    <div class="card">
      <h2>‚öôÔ∏è Estado del Test</h2>
      <div id="status" class="loading">
        <div class="spinner"></div>
        <p>Ejecutando c√°lculos...</p>
      </div>
    </div>
    
    <div id="results" style="display: none;"></div>
  </div>
  
  <script type="module">
    async function runTest() {
      try {
        const { calculateNatalChart } = await import('./src/services/realAstroCalculator.ts');
        
        // Fecha UTC
        const birthDate = new Date(Date.UTC(1988, 9, 16, 20, 50, 0));
        
        // Calcular carta
        const chart = await calculateNatalChart(
          birthDate,
          -34.6,
          -58.45,
          'Buenos Aires, Argentina'
        );
        
        // Mostrar resultados
        displayResults(chart);
        
      } catch (error) {
        document.getElementById('status').innerHTML = `
          <div style="color: #ef4444;">
            <h3>‚ùå Error</h3>
            <p>${error.message}</p>
          </div>
        `;
        console.error('Error:', error);
      }
    }
    
    function displayResults(chart) {
      document.getElementById('status').style.display = 'none';
      
      // Datos esperados
      const expected = {
        'Nodo Norte': { sign: 'Piscis', degree: 11.817, house: 12, retro: true },
        'Quir√≥n': { sign: 'C√°ncer', degree: 7.167, house: 3, retro: true },
        'Parte de la Fortuna': { sign: 'G√©minis', degree: 17.167, house: 3, retro: false },
        'V√©rtex': { sign: 'Libra', degree: 27.033, house: 7, retro: false },
      };
      
      // Obtener valores calculados
      const chiron = chart.sensitivePoints?.find(p => p.name === 'Quir√≥n');
      const northNode = chart.lunarNodes?.find(n => n.name === 'Nodo Norte');
      const fortune = chart.arabicParts?.find(p => p.name.includes('Fortuna'));
      const vertex = chart.advancedPoints?.find(p => p.name === 'V√©rtex');
      
      const results = [
        { name: 'Nodo Norte', symbol: '‚òä', calc: northNode, exp: expected['Nodo Norte'] },
        { name: 'Quir√≥n', symbol: '‚ö∑', calc: chiron, exp: expected['Quir√≥n'] },
        { name: 'Parte de la Fortuna', symbol: '‚äï', calc: fortune, exp: expected['Parte de la Fortuna'] },
        { name: 'V√©rtex', symbol: 'Vx', calc: vertex, exp: expected['V√©rtex'] },
      ];
      
      let html = '<div class="card"><h2>üìä Resultados de Comparaci√≥n</h2>';
      
      results.forEach(r => {
        const diff = r.calc ? Math.abs(r.calc.degree - r.exp.degree) : 999;
        const diffClass = diff < 1 ? 'diff-good' : diff < 3 ? 'diff-warning' : 'diff-bad';
        const status = r.calc ? (diff < 3 ? '‚úÖ' : '‚ö†Ô∏è') : '‚ùå';
        
        html += `
          <div class="comparison">
            <h4><span class="symbol">${r.symbol}</span>${r.name} ${status}</h4>
            ${r.calc ? `
              <table style="width: 100%; font-size: 0.95em;">
                <tr>
                  <th style="width: 150px;">Aspecto</th>
                  <th>Esperado</th>
                  <th>Calculado</th>
                  <th>Diferencia</th>
                </tr>
                <tr>
                  <td><strong>Signo</strong></td>
                  <td>${r.exp.sign}</td>
                  <td>${r.calc.sign || '-'}</td>
                  <td>${r.calc.sign === r.exp.sign ? '‚úÖ Igual' : '‚ùå Diferente'}</td>
                </tr>
                <tr>
                  <td><strong>Grados</strong></td>
                  <td>${r.exp.degree.toFixed(2)}¬∞</td>
                  <td>${r.calc.degree?.toFixed(2) || '-'}¬∞</td>
                  <td class="${diffClass}">${diff.toFixed(2)}¬∞</td>
                </tr>
                <tr>
                  <td><strong>Casa</strong></td>
                  <td>${r.exp.house}</td>
                  <td>${r.calc.house || '-'}</td>
                  <td>${r.calc.house === r.exp.house ? '‚úÖ Igual' : '‚ö†Ô∏è Diferente'}</td>
                </tr>
                ${r.exp.retro !== undefined ? `
                <tr>
                  <td><strong>Retr√≥grado</strong></td>
                  <td>${r.exp.retro ? 'S√≠ (R)' : 'No'}</td>
                  <td>${r.calc.retrograde ? 'S√≠ (R)' : 'No'}</td>
                  <td>${r.calc.retrograde === r.exp.retro ? '‚úÖ' : '‚ö†Ô∏è'}</td>
                </tr>
                ` : ''}
              </table>
            ` : '<p style="color: #ef4444;">‚ùå No calculado</p>'}
          </div>
        `;
      });
      
      html += '</div>';
      
      // Resumen
      const allPresent = results.every(r => r.calc);
      const allAccurate = results.every(r => {
        if (!r.calc) return false;
        const diff = Math.abs(r.calc.degree - r.exp.degree);
        return diff < 3;
      });
      
      html += `
        <div class="card">
          <h2>üéØ Resumen Final</h2>
          <div style="font-size: 1.2em; margin: 20px 0;">
            <p><span class="${allPresent ? 'status-ok' : 'status-error'}">${allPresent ? '‚úÖ' : '‚ùå'}</span> 
               Todos los puntos ${allPresent ? 'calculados' : 'faltantes'}</p>
            <p><span class="${allAccurate ? 'status-ok' : 'status-error'}">${allAccurate ? '‚úÖ' : '‚ö†Ô∏è'}</span> 
               Precisi√≥n ${allAccurate ? 'excelente (< 3¬∞)' : 'revisar (> 3¬∞)'}</p>
          </div>
          ${allPresent && allAccurate ? `
            <div style="background: #10b98110; padding: 20px; border-radius: 10px; border-left: 4px solid #10b981;">
              <h3 style="color: #10b981;">üéâ ¬°Test Exitoso!</h3>
              <p style="color: #333; margin-top: 10px;">
                Todos los puntos avanzados est√°n calcul√°ndose correctamente y aparecer√°n en la rueda con sus s√≠mbolos:
              </p>
              <div style="font-size: 1.5em; margin-top: 15px; color: #333;">
                ‚òä Nodo Norte | ‚òã Nodo Sur<br>
                ‚ö∑ Quir√≥n | ‚äï Parte de la Fortuna<br>
                Vx V√©rtex | AVx Anti-V√©rtex
              </div>
            </div>
          ` : `
            <div style="background: #f59e0b10; padding: 20px; border-radius: 10px; border-left: 4px solid #f59e0b;">
              <h3 style="color: #f59e0b;">‚ö†Ô∏è Revisar Configuraci√≥n</h3>
              <p style="color: #333; margin-top: 10px;">
                Verifica que los settings est√©n activados en la configuraci√≥n de la app.
              </p>
            </div>
          `}
        </div>
      `;
      
      // Datos completos
      html += `
        <div class="card">
          <h2>üíæ Datos Completos (JSON)</h2>
          <details>
            <summary style="cursor: pointer; padding: 10px; background: #f8f9ff; border-radius: 5px; margin-bottom: 10px;">
              Ver datos calculados (expandir)
            </summary>
            <pre>${JSON.stringify({
              planetas: chart.planets.length,
              asteroides: chart.asteroids?.length || 0,
              puntosSensibles: chart.sensitivePoints?.length || 0,
              nodosLunares: chart.lunarNodes?.length || 0,
              partesArabes: chart.arabicParts?.length || 0,
              puntosAvanzados: chart.advancedPoints?.length || 0,
              detalles: {
                quiron: chiron,
                nodoNorte: northNode,
                fortuna: fortune,
                vertex: vertex
              }
            }, null, 2)}</pre>
          </details>
        </div>
      `;
      
      document.getElementById('results').innerHTML = html;
      document.getElementById('results').style.display = 'block';
    }
    
    // Ejecutar test
    runTest();
  </script>
</body>
</html>
